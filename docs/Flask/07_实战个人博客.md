### å¤§å‹é¡¹ç›®ç»“æ„

å¯¹äºä¸­å°é¡¹ç›®æ¥è¯´ï¼Œä½¿ç”¨ç¨‹åºåŒ…è¶³ä»¥æ»¡è¶³å¼€å‘çš„éœ€æ±‚ï¼Œä½†å¦‚æœé¡¹ç›®æ›´åŠ å¤æ‚å’Œåºå¤§ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨å·¥å‚å‡½æ•°å’Œè“æœ¬ç­‰æŠ€å·§æ¥è¿›ä¸€æ­¥ç»„ç»‡Flaskç¨‹åºã€‚



#### ä½¿ç”¨è“æœ¬æ¨¡å—åŒ–ç¨‹åº

å®ä¾‹åŒ–Flaskæä¾›çš„Blueprintç±»å³å¯åˆ›å»ºä¸€ä¸ªè“æœ¬å®ä¾‹ã€‚åœ¨å®ä¾‹åŒ–Blueprintç±»æ—¶ï¼Œé™¤äº†ä¼ å…¥æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è“æœ¬åç§°ä¹‹å¤–ï¼Œåˆ›å»ºè“æœ¬å®ä¾‹å’Œå’Œä½¿ç”¨Flaskå¯¹è±¡åˆ›å»ºç¨‹åºå®ä¾‹çš„ä»£ç åŸºæœ¬ç›¸åŒï¼š

```python
from flask import Blueprint

bolg = Blueprint('blog', __name__)
```

åƒç¨‹åºå®ä¾‹ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥è“æœ¬å®ä¾‹æ³¨å†Œè·¯ç”±ã€é”™è¯¯å¤„ç†å‡½æ•°ã€ä¸Šä¸‹æ–‡å¤„ç†å‡½æ•°ã€è¯·æ±‚å¤„ç†å‡½æ•°ï¼Œç”šè‡³æ˜¯å•ç‹¬çš„é™æ€æ–‡ä»¶æ–‡ä»¶å¤¹å’Œæ¨¡æ¿æ–‡ä»¶å¤¹ã€‚åœ¨ä½¿ç”¨ä¸Šï¼Œå®ƒè·Ÿç¨‹åºå®ä¾‹ä¹Ÿå¾ˆç›¸ä¼¼ã€‚æ¯”å¦‚ï¼Œè“æœ¬å®ä¾‹åŒæ ·æ‹¥æœ‰ä¸€ä¸ªroute()è£…é¥°å™¨ï¼Œå¯ä»¥ç”¨æ¥æ³¨å†Œè·¯ç”±ï¼Œä½†å®é™…ä¸Šè“æœ¬å¯¹è±¡å’Œç¨‹åºå¯¹è±¡å´æœ‰å¾ˆå¤§ä¸åŒã€‚

**ä½¿ç”¨è“æœ¬ä¸ä»…ä»…æ˜¯å¯¹è§†å›¾å‡½æ•°è¿›è¡Œåˆ†ç±»ï¼Œè€Œæ˜¯å°†ç¨‹åºæŸä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ“ä½œç»„ç»‡åœ¨ä¸€èµ·ï¼Œè¿™ä¸ªè“æœ¬å®ä¾‹ä»¥åŠä¸€ç³»åˆ—æ³¨å†Œåœ¨è“æœ¬å®ä¾‹ä¸Šçš„æ“ä½œçš„é›†åˆï¼Œç§°ä¸ºä¸€ä¸ªè“æœ¬ã€‚**è“æœ¬æè¿°äº†ç¨‹åºæŸä¸€éƒ¨åˆ†çš„ç»†èŠ‚ï¼Œå®šä¹‰äº†ç›¸åº”çš„è·¯ç”±ã€é”™è¯¯å¤„ç†å‡½æ•°ã€ä¸Šä¸‹æ–‡å¤„ç†å™¨ã€è¯·æ±‚å¤„ç†å™¨ç­‰ä¸€ç³»åˆ—æ“ä½œã€‚ä½†æ˜¯å®ƒæœ¬èº«å¹¶ä¸èƒ½å‘æŒ¥ä½œç”¨ï¼Œåªæœ‰å½“å®ƒè¢«æ³¨å†Œåˆ°ç¨‹åºå®ä¾‹ä¸Šæ—¶ï¼Œå®ƒæ‰ä¼šçœŸæ­£å°†å…¶ä¸­çš„æ“ä½œé™„åŠ åˆ°ç¨‹åºä¸­ã€‚

**ä½¿ç”¨è“æœ¬å¯ä»¥å°†ç¨‹åºæ¨¡å—åŒ–ï¼ˆmodularï¼‰**ã€ä¸€ä¸ªç¨‹åºå¯ä»¥æ³¨å†Œå¤šä¸ªè“æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç¨‹åºæŒ‰ç…§åŠŸèƒ½åˆ†ç¦»æˆä¸åŒçš„ç»„ä»¶ï¼Œç„¶åä½¿ç”¨è“æœ¬æ¥ç»„ç»‡è¿™äº›ç»„ä»¶ã€‚è“æœ¬ä¸ä»…ä»…æ˜¯ä»£ç å±‚é¢ä¸Šçš„ç»„ç»‡ç¨‹åºï¼Œè¿˜å¯ä»¥åœ¨ç¨‹åºå±‚é¢ä¸Šå®šä¹‰å±æ€§ï¼Œå…·ä½“çš„å½¢å¼å³**ä¸ºè“æœ¬ä¸‹çš„æ‰€æœ‰è·¯ç”±è®¾ç½®ä¸åŒçš„URLå‰ç¼€æˆ–å­åŸŸåã€‚**

å¸¸è§çš„ä¾‹å­ï¼šä¸ºäº†è®©ç§»åŠ¨è®¾å¤‡æ‹¥æœ‰æ›´å¥½çš„ä½“éªŒï¼Œæˆ‘ä»¬ä¸ºç§»åŠ¨è®¾å¤‡åˆ›å»ºäº†å•ç‹¬çš„è§†å›¾å‡½æ•°ï¼Œè¿™éƒ¨åˆ†è§†å›¾å‡½æ•°å¯ä»¥ä½¿ç”¨å•ç‹¬çš„mobileè“æœ¬æ³¨å†Œï¼Œç„¶åä¸ºè¿™ä¸ªè“æœ¬è®¾ç½®å­åŸŸåmã€‚ç”¨æˆ·è®¿é—®m.example.comçš„è¯·æ±‚ä¼šè‡ªåŠ¨è¢«è¯¥è“æœ¬çš„è§†å›¾å‡½æ•°å¤„ç†ã€‚

##### 1. åˆ›å»ºè“æœ¬

è“æœ¬ä¸€èˆ¬åœ¨å­åŒ…ä¸­åˆ›å»ºï¼Œå¦‚åˆ›å»ºä¸€ä¸ªblogå­åŒ…ï¼Œç„¶ååœ¨æ„é€ æ–‡ä»¶ä¸­åˆ›å»ºè“æœ¬å®ä¾‹ï¼Œä½¿ç”¨åŒ…ç®¡ç†è“æœ¬å…è®¸ä½ è®¾ç½®è“æœ¬ç‹¬æœ‰çš„é™æ€æ–‡ä»¶å’Œæ¨¡æ¿ï¼Œå¹¶åœ¨è“æœ¬å†…å¯¹å„ç±»å‡½æ•°åˆ†æ¨¡å—å­˜å‚¨ã€‚

åœ¨ç®€å•ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æ¨¡å—ä¸­åˆ›å»ºè“æœ¬å®ä¾‹ï¼Œå¦‚åœ¨auth.pyä¸­åˆ›å»ºauth_bpè“æœ¬å®ä¾‹ï¼š

```python
from flask import Blueprint
auth_bp = Blueprint('auth', __name__)
```

æ„é€ æ–¹æ³•ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è“æœ¬çš„åç§°ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯åŒ…æˆ–è€…æ¨¡å—çš„åç§°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`__name__`å˜é‡ã€‚

##### 2. è£…é…è“æœ¬

**ï¼ˆ1ï¼‰è§†å›¾å‡½æ•°**

è“æœ¬ä¸­çš„è§†å›¾å‡½æ•°é€šè¿‡è“æœ¬å®ä¾‹æä¾›çš„route()è£…é¥°å™¨æ³¨å†Œï¼Œå¦‚`@auth_bp.route()`

```python
from flask import Blueprint
auth_bp = Blueprint('auth', __name__)

@auth_bp.route('/login')
def login():
  ...
  
@auth_bp.route('/logout')
def logout():
  ...
```

**ï¼ˆ2ï¼‰é”™è¯¯å¤„ç†å‡½æ•°**

ä½¿ç”¨è“æœ¬å®ä¾‹çš„errorhandler()è£…é¥°å™¨å¯ä»¥æŠŠé”™è¯¯å¤„ç†å™¨æ³¨å†Œåˆ°è“æœ¬ä¸Šï¼Œè¿™äº›é”™è¯¯å¤„ç†å™¨åªä¼šæ•æ‰è®¿é—®è¯¥è“æœ¬ä¸­çš„è·¯ç”±å‘ç”Ÿçš„é”™è¯¯ï¼›ä½¿ç”¨è“æœ¬å®ä¾‹çš„app_errorhandler()è£…é¥°å™¨åˆ™å¯ä»¥æ³¨å†Œä¸€ä¸ªå…¨å±€çš„é”™è¯¯å¤„ç†å™¨ã€‚

> æ³¨æ„ğŸ“¢ğŸ“¢ï¼š404å’Œ405é”™è¯¯ä»…ä¼šè¢«å…¨å±€çš„é”™è¯¯å¤„ç†å‡½æ•°æ•æ‰ï¼Œå¦‚æœä½ æƒ³åŒºåˆ†è“æœ¬ URLä¸‹çš„404å’Œ405é”™è¯¯ï¼Œå¯ä»¥åœ¨å…¨å±€å®šä¹‰çš„404é”™è¯¯å¤„ç†å‡½æ•°ä¸­ä½¿ç”¨ request.path.startswith('<è“æœ¬çš„URLå‰ç¼€>')æ¥åˆ¤æ–­è¯·æ±‚çš„URLæ˜¯å¦å± äºæŸä¸ªè“æœ¬ã€‚

**ï¼ˆ3ï¼‰è¯·æ±‚å¤„ç†å‡½æ•°**

åœ¨è“æœ¬ä¸­ï¼Œä½¿ç”¨before_requestã€after_requestã€teardown_requestç­‰è£…é¥°å™¨æ³¨å†Œçš„è¯·æ±‚å¤„ç†å‡½æ•°æ—¶è“æœ¬ç‹¬æœ‰çš„ï¼Œå³åªæœ‰è¯¥è“æœ¬ä¸­çš„è§†å›¾å‡½æ•°å¯¹åº”çš„è¯·æ±‚æ‰ä¼šè§¦å‘ç›¸åº”çš„è¯·æ±‚å¤„ç†å‡½æ•°ã€‚å¦å¤–åœ¨è“æœ¬ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨before_app_requestã€after_app_requestã€teardown_app_requestã€before_app_first_requestæ–¹æ³•ï¼Œè¿™äº›æ”¾æ–¹æ³•æ³¨å†Œçš„è¯·æ±‚å¤„ç†å‡½æ•°æ—¶å…¨å±€çš„ã€‚

**ï¼ˆ4ï¼‰æ¨¡æ¿ä¸Šä¸‹æ–‡å¤„ç†å‡½æ•°**

å’Œè¯·æ±‚é’©å­ç±»ä¼¼ï¼Œè“å›¾å®ä¾‹å¯ä»¥ä½¿ç”¨context_processorè£…é¥°å™¨æ³¨å†Œè“æœ¬ç‰¹æœ‰çš„æ¨¡æ¿ä¸Šä¸‹æ–‡å¤„ç†å™¨ï¼›ä½¿ç”¨app_context_processorè£…é¥°å™¨åˆ™ä¼šæ³¨å†Œç¨‹åºå…¨å±€çš„æ¨¡æ¿ä¸Šä¸‹æ–‡å¤„ç†å™¨ã€‚

å¦å¤–ï¼Œè“æœ¬å¯¹è±¡ä¹Ÿå¯ä»¥ä½¿ç”¨app_template_global()ã€app_template_filter()å’Œapp_template_test()è£…é¥°å™¨ï¼Œåˆ†åˆ«ç”¨æ¥æ³¨å†Œå…¨å±€çš„æ¨¡æ¿å…¨å±€å‡½æ•°ã€æ¨¡æ¿è¿‡æ»¤å‡½æ•°å’Œæ¨¡æ¿æµ‹è¯•å™¨ã€‚

> æ³¨æ„ğŸ“¢ğŸ“¢ï¼šå¹¶ä¸æ˜¯æ‰€æœ‰ç¨‹åºå®ä¾‹æä¾›çš„æ–¹æ³•å’Œå±æ€§éƒ½å¯ä»¥åœ¨è“æœ¬å¯¹è±¡ä¸Šè°ƒç”¨ï¼Œè“æœ¬å¯¹è±¡åªæä¾›äº†å°‘é‡ç”¨äºæ³¨å†Œå¤„ç†å‡½æ•°çš„æ–¹æ³•ï¼Œå¤§éƒ¨åˆ†çš„å±æ€§å’Œæ–¹æ³•æˆ‘ä»¬ä»ç„¶éœ€è¦é€šè¿‡ç¨‹åºå®ä¾‹è·å–ï¼Œæ¯”å¦‚è¡¨ç¤ºé…ç½®çš„configå±æ€§ï¼Œæˆ–æ˜¯æ³¨å†Œè‡ªåŠ¨ä»¥å‘½ä»¤çš„cli.command()è£…é¥°å™¨ã€‚

##### 3. æ³¨å†Œè“æœ¬

è“æœ¬ä½¿ç”¨Flask.register_blueprint()æ–¹æ³•æ³¨å†Œï¼Œ

```python
from bluelog.bluerprints.auth import auth_bp
...
app.register_blueprint(auth_bp)
```

å¿…é¡»ä¼ å…¥çš„å‚æ•°æ˜¯æˆ‘ä»¬åˆ›å»ºçš„è“æœ¬å¯¹è±¡ã€‚å…¶ä»–å‚æ•°å¯ä»¥ç”¨æ¥æ§åˆ¶è“æœ¬çš„è¡Œä¸ºã€‚æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨`url_prefix`å‚æ•°ä¸ºauthè“æœ¬ä¸‹çš„æ‰€æœ‰è§†å›¾URLç¦å»ºä¸€ä¸ªURLå‰ç¼€ï¼š

```python
app.register_blueprint(auth_bp, url_prefix='/auth')
```

è¿™æ ·ï¼Œauthè“æœ¬ä¸‹çš„è§†å›¾çš„URLéƒ½ä¼šæ·»åŠ ä¸€ä¸ªauth/å‰ç¼€ï¼Œæ¯”å¦‚loginè§†å›¾çš„URLè§„åˆ™ä¼šå˜ä¸º`/auth/login`ã€‚

ä½¿ç”¨subdomainå‚æ•°å¯ä»¥ä¸ºè“æœ¬ä¸‹çš„è·¯ç”±è®¾ç½®å­åŸŸåã€‚ä¸‹é¢è“æœ¬ä¸­çš„æ‰€æœ‰è§†å›¾ä¼šåŒ¹é…æ¥è‡ªauthå­åŸŸåçš„è¯·æ±‚ï¼š

```python
app.register_blueprint(auth_bp, subdomain='auth')
```

è¿™æ—¶è®¿é—®ç±»ä¼¼auth.example.com/authçš„URLæ‰ä¼šè§¦å‘authè“æœ¬ä¸­çš„loginè§†å›¾ã€‚

> Register_blueprint()æ–¹æ³•æ¥æ”¶çš„é¢å¤–å‚æ•°å’ŒBlueprintç±»çš„æ„é€ æ–¹æ³•åŸºæœ¬ç›¸åŒï¼Œåœ¨è¿™é‡Œä¼ å…¥çš„å‚æ•°ä¼šè¦†ç›–ä¼ å…¥è“æœ¬æ„é€ æ–¹æ³•çš„å‚æ•°ã€‚

#####  4. è“æœ¬çš„è·¯ç”±ç«¯ç‚¹

**ç«¯ç‚¹ï¼šURLè§„åˆ™å’Œè§†å›¾å‡½æ•°çš„ä¸­é—´åª’ä»‹ã€‚**

æˆ‘ä»¬ä½¿ç”¨@app.route()è£…é¥°å™¨å°†è§†å›¾å‡½æ•°æ³¨å†Œä¸ºè·¯ç”±ï¼š

```python
@app.route('/hello')
def say_hello():
  return 'hello'
```

å¦‚æœä¸ä½¿ç”¨è£…é¥°å™¨ï¼Œä½¿ç”¨app.add_url_rule()æ–¹æ³•åŒæ ·ä¹Ÿå¯ä»¥æ³¨å†Œè·¯ç”±ï¼š

```python
def say_hello():
  return 'hello'
app.add_url_rule('/hello', 'say_hello', say_hello)
```

add_url_rule(rule, endpoint, view_func)çš„ç¬¬äºŒä¸ªå‚æ•°å³æŒ‡å®šçš„ç«¯ç‚¹ï¼ˆendpoint)ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è§†å›¾å‡½æ•°å¯¹è±¡ã€‚**åœ¨è·¯ç”±é‡Œï¼ŒURLè§„åˆ™å’Œè§†å›¾å‡½æ•°å¹¶ä¸æ˜¯ç›´æ¥æ˜ å°„çš„ï¼Œè€Œæ˜¯é€šè¿‡ç«¯ç‚¹ä½œä¸ºä¸­é—´åª’ä»‹ã€‚**ç±»ä¼¼è¿™æ ·ï¼š

```
/hello(URLè§„åˆ™) -> say_hello(ç«¯ç‚¹) -> say_hello(è§†å›¾å‡½æ•°)
```

**é»˜è®¤æƒ…å†µä¸‹ï¼Œç«¯ç‚¹æ˜¯è§†å›¾å‡½æ•°çš„åç§°**ï¼Œè¿™é‡Œæ˜¯say_helloã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ˜¾ç¤ºåœ°ä½¿ç”¨endpointå‚æ•°æ”¹å˜å®ƒï¼Œå³ï¼š

```python
@app.route('/hello', endpoing='give_greeting')
def say_hello():
  return 'hello'
```

è¿™æ˜¯ç«¯ç‚¹å˜æˆäº†give_greetingï¼Œæ˜ å°„è§„åˆ™ä¹Ÿç›¸åº”å˜ä¸ºï¼š

```
/hello(URLè§„åˆ™) -> give_greeting(ç«¯ç‚¹) -> say_hello(è§†å›¾å‡½æ•°)
```

æˆ‘ä»¬ä½¿ç”¨`flask routes`å‘½ä»¤æŸ¥çœ‹å½“å‰ç¨‹åºæ³¨å†Œçš„æ‰€æœ‰è·¯ç”±ï¼š

```shell
$ flask routes
Endpoint          Methods    Rule
----------------  ---------  ---------------------------------
auth.login        GET, POST  /auth/login
auth.logout       GET        /auth/logout
blog.about        GET        /about
blog.category     GET        /category/<int:category_id>
bootstrap.static  GET        /bootstrap/static/<path:filename>
ckeditor.static   GET        /ckeditor/static/<path:filename>
static            GET        /static/<path:filename>
```

æ¯ä¸ªè·¯ç”±çš„URLè§„åˆ™ï¼ˆRuleï¼‰å¯¹åº”çš„ç«¯ç‚¹ï¼ˆEndpointï¼‰å€¼ä¸å†ä»…ä»…æ˜¯è§†å›¾å‡½æ•°åï¼Œè€Œæ˜¯`è“æœ¬å.è§†å›¾å‡½æ•°å`çš„å½¢å¼ã€‚å‰é¢æˆ‘ä»¬ç•™ä¸‹äº†ä¸€ä¸ªç–‘é—®ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥æ˜ å°„URLè§„åˆ™ç†¬è§†å›¾å‡½æ•°å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ï¼šä½¿ç”¨ç«¯ç‚¹å¯ä»¥å®ç°è“æœ¬çš„è§†å›¾å‡½æ•°å‘½åç©ºé—´ã€‚

å½“ä½¿ç”¨è“æœ¬æ—¶ï¼Œä½ å¯èƒ½ä¼šåœ¨ä¸åŒçš„è“æœ¬ä¸­åˆ›å»ºåŒåçš„è§†å›¾å‡½æ•°ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸¤ä¸ªè“æœ¬ä¸­éƒ½æœ‰ä¸€ä¸ªindexè§†å›¾ï¼Œè¿™æ˜¯åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨url_for()è·å–URLæ—¶ï¼Œå› ä¸ºå¡«å…¥çš„ç«¯ç‚¹å‚æ•°å€¼æ˜¯è§†å›¾å‡½æ•°çš„åç§°(å³index)ï¼Œå°±ä¼šäº§ç”Ÿå†²çªã€‚**Flaskåœ¨ç«¯ç‚¹å‰æ·»åŠ è“æœ¬çš„åç§°ï¼Œæ‰©å±•äº†ç«¯ç‚¹çš„å‘½åç©ºé—´ï¼Œè§£å†³äº†è§†å›¾å‡½æ•°é‡åçš„é—®é¢˜ã€‚**æ­£å› å¦‚æ­¤ï¼Œä¸€æ—¦ä½¿ç”¨è“æœ¬ï¼Œæˆ‘ä»¬å°±è¦å¯¹ç¨‹åºä¸­æ‰€æœ‰url_for()å‡½æ•°ä¸­çš„ç«¯ç‚¹å€¼å°±è¡Œä¿®æ”¹ï¼Œæ·»åŠ è“æœ¬åæ¥æ˜ç¡®ç«¯ç‚¹çš„å½’å±ã€‚

æ¯”å¦‚åœ¨ç”Ÿæˆauthè“æœ¬ä¸‹çš„loginè§†å›¾çš„urlæ—¶ï¼Œéœ€è¦ä½¿ç”¨ä¸‹é¢çš„ç«¯ç‚¹

```python
url_for('auth.login')
```

ç«¯ç‚¹åœ¨è“æœ¬å†…éƒ¨å¯ä»¥ä½¿ç”¨`.è§†å›¾å‡½æ•°å`çš„å®è¡Œæ¥çœç•¥è“æœ¬åç§°ï¼Œæ¯”å¦‚`auth.login`å¯ä»¥ç®€å†™æˆ`.login`ã€‚ä½†æ˜¯åœ¨å…¨å±€ç¯å¢ƒä¸­ï¼Œæ¯”å¦‚åœ¨åŸºæ¨¡æ¿æˆ–æ˜¯åœ¨Aç¯®æ¿ä¸­çš„è„šæœ¬ã€æ¸²æŸ“çš„æ¨¡æ¿ä¸­éœ€è¦ç”ŸæˆBè“æœ¬çš„URLï¼Œè¿™æ˜¯çš„ç«¯ç‚¹å€¼åˆ™å¿…é¡»ä½¿ç”¨æŒ–æ­£çš„åç§°ã€‚

ä½¿ç”¨è“æœ¬å¯ä»¥é¿å…ç«¯ç‚¹å€¼çš„é‡å¤å†²çªï¼Œä½†æ˜¯è·¯ç”±URLè§„åˆ™è¿˜æ˜¯ä¼šäº§ç”Ÿé‡å¤ã€‚æ¯”å¦‚ï¼Œä¸¤ä¸ªè“æœ¬ä¸­çš„ä¸»é¡µè§†å›¾çš„URLè§„åˆ™éƒ½æ˜¯`/home`ï¼ŒæŒ¡åœ¨æµè§ˆå™¨ä¸­è®¿é—®è¿™ä¸ªåœ°å€æ—¶ï¼Œè¯·æ±‚åªä¼šåˆ†é…åˆ°ç¬¬ä¸€ä¸ªè¢«æ³¨å†Œçš„è“æœ¬ä¸­çš„ä¸»é¡µè§†å›¾ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥åœ¨æ³¨å†Œè“æœ¬æ—¶ä½¿ç”¨å…³é”®å­—å‚æ•°url_prefixåœ¨è“æœ¬çš„URLè§„åˆ™å‰æ·»åŠ ä¸€ä¸ªå‰ç¼€æ¥è§£å†³ã€‚

##### 5. è“æœ¬èµ„æº

å¦‚æœç¨‹åºçš„ä¸åŒè“æœ¬çš„é¡µé¢éœ€è¦æˆªç„¶ä¸åŒçš„æ ·å¼ï¼Œå¯ä»¥ä¸ºè“æœ¬å®šä¹‰ç‹¬æœ‰çš„é™æ€æ–‡ä»¶å’Œæ¨¡æ¿ã€‚è¿™æ˜¯æˆ‘ä»¬éœ€è¦æŠŠè“æœ¬å‡çº§ä¸ºåŒ…ï¼Œåœ¨æ„é€ æ–‡ä»¶å¤¹ä¸­åˆ›å»ºè“æœ¬å®ä¾‹ï¼Œå¹¶åœ¨è“æœ¬åŒ…ä¸­åˆ›å»ºé™æ€æ–‡ä»¶æ–‡ä»¶å¤¹staticå’Œæ¨¡æ¿æ–‡ä»¶å¤¹templatesã€‚å’Œç¨‹åºå®ä¾‹ä¸€æ ·ï¼Œå®ä¾‹åŒ–æ—¶ä¼ å…¥çš„`__name__`å˜é‡ä¸ºè¢«ç”¨æ¥åˆ¤æ–­è“æœ¬çš„æ ¹ç›®å½•ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºåŸºç¡€å¯»æ—©æ¨¡æ¿æ–‡ä»¶å¤¹å’Œé™æ€æ–‡ä»¶æ–‡ä»¶å¤¹ã€‚

è¦ä½¿ç”¨è“æœ¬ç‹¬æœ‰çš„é™æ€æ–‡ä»¶ï¼Œä½ éœ€è¦åœ¨å®šä¹‰è“æœ¬æ—¶ä½¿ç”¨static_folderå…³é”®å­—å‚æ•°æŒ‡å®šè“æœ¬çš„é™æ€æ–‡ä»¶æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼š

```python
auth_bp = Blueprint('auth', __name__, static_folder='static', static_url_path='/')
```

static_folderå‚æ•°çš„å€¼å¯ä»¥ä½¿ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹äºè“æœ¬æ‰€åœ¨æ–‡ä»¶å¤¹çš„ç›¸å¯¹è·¯å¾„ã€‚å¦å¤–ï¼Œå› ä¸ºè“æœ¬å†…ç½®çš„staticè·¯ç”±çš„URLè§„åˆ™å’Œç¨‹åºçš„staticè·¯ç”±çš„URLè§„åˆ™ç›¸åŒï¼Œéƒ½æ˜¯`/static`ï¼Œä¸ºäº†é¿å…å†²çªï¼Œæˆ‘ä»¬ä½¿ç”¨å¯é€‰çš„static_url_pahtå‚æ•°ä¸ºè“æœ¬ä¸‹çš„staticåˆ¶å®šäº†æ–°çš„URLè§„åˆ™ã€‚

> å¦‚æœä½ å†æ³¨å†Œè“æœ¬æ—¶å®šä¹‰äº†URLå‰ç¼€ï¼Œå³è®¾ç½®äº†url_prefixå‚æ•°ï¼Œé‚£ä¹ˆæœ€ç»ˆçš„è“æœ¬é™æ€æ–‡ä»¶è·¯å¾„ä¼šè‡ªåŠ¨è®¾ä¸º`/è“æœ¬å‰ç¼€/static`ï¼Œè¿™æ—¶å¯ä»¥çœç•¥static_url_pathçš„å®šä¹‰ã€‚

åœ¨ç”Ÿæˆç”¨æ¥è·å–è“æœ¬é™æ€æ–‡ä»¶çš„URLæ—¶éœ€è¦å†™å‡ºåŒ…å«è“æœ¬åç§°çš„å®Œæ•´ç«¯ç‚¹ï¼Œå³`è“æœ¬å.static`ï¼Œä¸‹é¢çš„è°ƒç”¨ä¼šè¿”å›`auth/static/style.css`:

```python
url_for('auth.static', filename='style.css')
```

å½“è“æœ¬åŒ…å«ç‹¬æœ‰çš„æ¨¡æ¿æ–‡ä»¶å¤¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®ä¾‹åŒ–è“æœ¬ç±»æ—¶ä½¿ç”¨template_folderå…³é”®å­—æŒ‡å®šæ¨¡æ¿æ–‡ä»¶å¤¹çš„ä½ç½®ï¼š

```python
auth_bp= Blueprint('auth', __name__, template_folder='templates')
```

å½“æˆ‘ä»¬åœ¨è“æœ¬ä¸­çš„è§†å›¾å‡½æ•°æ¸²æŸ“ä¸€ä¸ªindex.htmlæ¨¡æ¿æ—¶ï¼ŒFlaskä¼šä¼˜å…ˆä»å…¨å±€çš„æ¨¡æ¿æ–‡ä»¶ä¸­å¯»æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå†åˆ°è“æœ¬æ‰€åœ¨çš„æ¨¡æ¿æ–‡ä»¶å¤¹æŸ¥æ‰¾ã€‚å› æ­¤ï¼Œä¸ºäº†é¿å…è“æœ¬çš„æ¨¡æ¿æ–‡ä»¶å¤¹å’Œå…¨å±€æ¨¡æ¿æ–‡ä»¶å¤¹ä¸­å­˜åœ¨åŒåæ–‡ä»¶å¯¼è‡´å†²çªï¼Œé€šå¸¸ä¼šåœ¨è“æœ¬çš„æ¨¡æ¿æ–‡ä»¶å¤¹ä¸­ä»¥è“æœ¬åç§°æ–°å»ºä¸€ä¸ªå­æ–‡ä»¶å¤¹å­˜å‚¨æ¨¡æ¿ã€‚

å¦‚æœè“æœ¬ä¹‹é—´çš„å…³è”æ¯”è¾ƒå¤§ï¼Œå…±ç”¨ä¸€ä¸ªåŸºæ¨¡æ¿ï¼Œæ›´å¸¸è§çš„æ–¹æ³•æ˜¯åªåœ¨å…¨å±€çš„æ¨¡æ¿æ–‡ä»¶å¤¹ä¸­å­˜å‚¨æ¨¡æ¿ï¼Œåœ¨å…¶ä¸­å¯ä»¥å»ºç«‹å­æ–‡ä»¶å¤¹æ¥è¿›è¡Œç»„ç»‡ï¼›é™æ€æ–‡ä»¶çš„å¤„ç†æ–¹å¼ç›¸åŒã€‚



#### ä½¿ç”¨ç±»ç»„ç»‡é…ç½®

åœ¨å®é™…éœ€æ±‚ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦ä¸åŒçš„é…ç½®ç»„åˆã€‚ä¾‹å¦‚å¼€å‘ç”¨çš„é…ç½®ã€æµ‹è¯•ç”¨çš„é…ç½®ã€ç”Ÿæˆç¯å¢ƒç”¨çš„é…ç½®ç­‰ã€‚ä¸ºäº†èƒ½æ–¹ä¾¿åœ°åœ¨è¿™äº›é…ç½®ä¸­åˆ‡æ¢ï¼Œæœ€æ–¹ä¾¿çš„åšæ³•æ˜¯åœ¨å•ä¸ªé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨Pythonç±»æ¥ç»„ç»‡å¤šä¸ªä¸åŒç±»åˆ«çš„é…ç½®ã€‚

æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶settings.pyä¸­åˆ›å»ºä¸€ä¸ªåŸºæœ¬é…ç½®ç±»BaseConfigã€æµ‹è¯•é…ç½®ç±»TestingConfigã€å¼€å‘é…ç½®ç±»DevelopmentConfigã€ç”Ÿäº§é…ç½®ç±»ProductionConfigã€‚

```python
import os

dev_db = 'postgresql://zhengyaqi@localhost/xxx'
test_db = 'postgresql://zhengyaqi@localhost/yyy'
prod_db = 'postgresql://zhengyaqi@localhost/zzz'

class BaseConfig(object):
    SECRET_KEY = os.getenv('SECRET_KEY', 'secret key')
    SQLALCHEMY_TRACK_MODIFICATIONS = False

class DevelopmentConfig(BaseConfig):
    SQLALCHEMY_DATABASE_URI = os.getenv('DATABASE_URI', dev_db)


class TestingConfig(BaseConfig):
    SQLALCHEMY_DATABASE_URI = os.getenv('DATABASE_URI', test_db)

class ProductionConfig(BaseConfig):
    SQLALCHEMY_DATABASE_URI = os.getenv('DATABASE_URI', prod_db)

config = {
    'development': DevelopmentConfig,
    'testing': TestingConfig,
    'production': ProductionConfig
}
```

åœ¨é…ç½®æ–‡ä»¶åº•éƒ¨ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå­˜å‚¨é…ç½®åç§°å’Œå¯¹åº”é…ç½®ç±»çš„å­—æ®µï¼Œç”¨äºåœ¨åˆ›å»ºç¨‹åºå®ä¾‹æ—¶é€šè¿‡é…ç½®åç§°æ¥è·å–å¯¹åº”çš„é…ç½®ç±»ã€‚ç°åœ¨æˆ‘ä»¬åœ¨åˆ›å»ºç¨‹åºå®ä¾‹åä½¿ç”¨`app.config.from_object()`æ–¹æ³•åŠ è½½é…ç½®ï¼Œä¼ å…¥é…ç½®ç±»ï¼š

```python
from blueblog.settings import config

app = Flask(__name__)
config_name = os.getenv('FLASK_CONFIG_NAME', 'development')
app.config.from_object(config[config_name])
```

é¦–å…ˆä»é…ç½®æ–‡ä»¶ä¸­å¯¼å…¥åŒ¹é…é…ç½®ååˆ°é…ç½®ç±»çš„configå­—æ®µã€‚ä¸ºäº†æ–¹ä¾¿ä¿®æ”¹é…ç½®ç±»å‹ï¼Œé…ç½®åç§°config_nameä¼šå…ˆä»ç¯å¢ƒå˜é‡FLASK_CONFIG_NAMEä¸­è·å–ï¼Œä»ç¯å¢ƒå˜é‡åŠ è½½é…ç½®å¯ä»¥æ–¹ä¾¿åœ°åœ¨ä¸æ”¹åŠ¨ä»£ç çš„æƒ…å†µä¸‹åˆ‡æ¢é…ç½®ã€‚



#### ä½¿ç”¨å·¥å‚å‡½æ•°åˆ›å»ºç¨‹åºå®ä¾‹

ä½¿ç”¨è“æœ¬è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å¥½å¤„ï¼Œé‚£å°±æ˜¯å…è®¸ä½¿ç”¨å·¥å‚å‡½æ•°æ¥åˆ›å»ºç¨‹åºå®ä¾‹ã€‚**åœ¨OOP(Object-Oriented Programmingï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹)ä¸­ï¼Œå·¥å‚ï¼ˆfactoryï¼‰æ˜¯æŒ‡åˆ›å»ºå…¶ä»–å¯¹è±¡çš„å¯¹è±¡ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªè¿”å›å…¶ä»–ç±»çš„å¯¹è±¡çš„å‡½æ•°æˆ–æ–¹æ³•ã€‚**æŒ‰ç…§ç®¡ç†ï¼Œè¿™ä¸ªå‡½æ•°è¢«å‘½åä¸ºcreate_app()æˆ–make_app()ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªå·¥å‚å‡½æ•°ç§°ä¸ºç¨‹åºå·¥å‚ï¼ˆApplication Factoryï¼‰ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹åˆ›å»ºç¨‹åºå®ä¾‹ã€‚

å·¥å‚å‡½æ•°ä½¿å¾—æµ‹è¯•å’Œéƒ¨ç½²æ›´åŠ æ–¹ä¾¿ã€‚æˆ‘ä»¬ä¸å¿…å°†åŠ è½½çš„é…ç½®å†™æ­»åœ¨æŸå¤„ï¼Œè€Œæ˜¯ç›´æ¥åœ¨ä¸åŒçš„åœ°æ–¹æŒ‰ç…§éœ€è¦çš„é…ç½®åˆ›å»ºç¨‹åºå®ä¾‹ã€‚é€šè¿‡æ”¯æŒåˆ›å»ºå¤šä¸ªç¨‹åºå®ä¾‹ï¼Œå·¥å‚å‡½æ•°æä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ã€‚å¦å¤–ï¼Œå€ŸåŠ©å·¥å‚å‡½æ•°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ†ç¦»æ‰©å±•çš„åˆå§‹åŒ–æ“ä½œã€‚åˆ›å»ºæ‰©å±•å¯¹è±¡çš„æ“ä½œå¯ä»¥åˆ†ç¦»åˆ°å•ç‹¬çš„æ¨¡å—ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆå‡å°‘å¾ªç¯ä¾èµ–çš„å‘ç”Ÿã€‚

`__init__.py`æ–‡ä»¶ä¸­çš„å·¥å‚å‡½æ•°å¦‚ä¸‹ï¼š

```python
def create_app(config_name=None):
    if config_name is None:
        config_name = os.getenv('FLASK_CONFIG_NAME', 'development')
    app = Flask('bluelog')
    app.config.from_object(config[config_name])

    app.register_blueprint(auth_bp, url_prefix='/auth')
    app.register_blueprint(admin_bp, url_prefix='/admin')
    app.register_blueprint(blog_bp, prefix='/blog')

    return app
```

> å·¥å‚å‡½æ•°ä¸€èˆ¬åœ¨ç¨‹åºåŒ…çš„æ„é€ æ–‡ä»¶ä¸­åˆ›å»ºï¼Œä¹Ÿå¯ä»¥åœ¨ç¨‹åºåŒ…å†…æ–°åˆ›å»ºçš„æ¨¡å—å¦‚factory.pyæˆ–app.pyä¸­å­˜æ”¾ã€‚

##### 1. åŠ è½½é…ç½®

å·¥å‚å‡½æ•°æ¥æ”¶é…ç½®åç§°ä½œä¸ºå‚æ•°ï¼Œè¿™å…è®¸æˆ‘ä»¬åœ¨ç¨‹åºçš„ä¸åŒä½ç½®ä¼ å…¥ä¸åŒçš„é…ç½®æ¥åˆ›å»ºç¨‹åºå®ä¾‹ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨å·¥å‚å‡½æ•°åï¼Œæˆ‘ä»¬å¯ä»¥å†æµ‹è¯•è„šæœ¬ä¸­ä½¿ç”¨æµ‹è¯•é…ç½®æ¥è°ƒç”¨å·¥å‚å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªå•ç‹¬ç”¨äºæµ‹è¯•çš„ç¨‹åºå®ä¾‹ï¼Œè€Œä¸ç”¨ä»æŸä¸ªæ¨¡å—å¯¼å…¥ç¨‹åºå®ä¾‹ã€‚

##### 2. åˆå§‹åŒ–æ‰©å±•

ä¸ºäº†å®Œæˆæ‹“å±•åˆå§‹åŒ–æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦åœ¨å®ä¾‹åŒ–æ‰©å±•ç±»æ—¶ä¼ å…¥ç¨‹åºå®ä¾‹ã€‚ä½†æ˜¯ç”¨å·¥å‚å‡½æ•°åï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªåˆ›å»ºå¥½çš„ç¨‹åºå®ä¾‹å¯ä»¥å¯¼å…¥ã€‚å¦‚æœæˆ‘ä»¬æŠŠå®ä¾‹åŒ–æ“ä½œæ”¾åˆ°å·¥å‚å‡½æ•°ä¸­ï¼Œé‚£æˆ‘ä»¬å°±æ²¡æœ‰ä¸€ä¸ªå…¨å±€çš„æ‰©å±•ï¼ˆç±»ä¼¼dbå¯¹è±¡ï¼‰å¯ä»¥ä½¿ç”¨ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ**å¤§éƒ¨åˆ†æ‰©å±•éƒ½æä¾›äº†ä¸€ä¸ªinit_app()æ–¹æ³•æ¥æ”¯æŒåˆ†ç¦»æ‰©å±•çš„å®ä¾‹åŒ–å’Œåˆå§‹åŒ–æ“ä½œã€‚**ç°åœ¨æˆ‘ä»¬ä»åƒå¾€å¸¸ä¸€æ ·åˆå§‹åŒ–æ‰©å±•ç±»ï¼Œä½†å¹¶ä¸ä¼ å…¥ç¨‹åºå®ä¾‹ã€‚è¿™æ—¶æ‰©å±•ç±»å®ä¾‹åŒ–çš„å·¥ä½œå¯ä»¥é›†ä¸­æ”¾åœ¨extensions.pyè„šæœ¬ä¸­ï¼Œå¦‚ä¸‹ï¼š

```python
from flask_sqlalchemy import SQLAlchemy
from flask_migrate import Migrate
...

db = SQLAlchemy()
migrate = Migrate()
...
```

ç°åœ¨å½“æˆ‘ä»¬éœ€è¦åœ¨ç¨‹åºä¸­ä½¿ç”¨æ‰©å±•å¯¹è±¡æ—¶ï¼Œç›´æ¥ä»extensionsæ¨¡å—å¯¼å…¥å³å¯ã€‚åœ¨`__init__.py`æ–‡ä»¶çš„å·¥å‚å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥æ‰€æœ‰æ‰©å±•å¯¹è±¡ï¼Œå¹¶å¯¹å…¶è°ƒç”¨init_app()æ–¹æ³•ï¼Œä¼ å…¥ç¨‹åºå®ä¾‹å®Œæˆåˆå§‹åŒ–æ“ä½œï¼š

```python
from bluelog.extensions import db, migrate, moment, ckeditor, mail, bootstrap
...
def create_app(config_name=None):
    ...
    # åˆ›å»ºapp
    app = Flask('bluelog')
		...
    # åˆå§‹åŒ–æ‰©å±•
    db.init_app(app)
    migrate.init_app(app, db=db)
		...
    return app
```

##### 3. ç»„ç»‡å·¥å‚å‡½æ•°

é™¤äº†æ‹“å±•åˆå§‹åŒ–æ“ä½œï¼Œè¿˜æœ‰å¾ˆå¤šå¤„ç†å‡½æ•°è¦æ³¨å†Œåˆ°ç¨‹åºä¸Šï¼Œæ¯”å¦‚é”™è¯¯å¤„ç†å‡½æ•°ã€ä¸Šä¸‹æ–‡å¤„ç†å‡½æ•°ç­‰ã€‚è™½ç„¶è“æœ¬ä¹Ÿå¯ä»¥æ³¨å†Œå…¨å±€çš„å¤„ç†å‡½æ•°ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œé™¤äº†è“æœ¬ç‰¹å®šçš„å¤„ç†å‡½æ•°ï¼Œè¿™äº›å¤„ç†å‡½æ•°ä¸€èˆ¬éƒ½æ”¾åœ¨å·¥å‚å‡½æ•°ä¸­æ³¨å†Œã€‚

ä¸ºäº†é¿å…æŠŠå·¥å‚å‡½æ•°å¼„å¾—å¤ªé•¿å¤ªå¤æ‚ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç±»åˆ«æŠŠè¿™äº›ä»£ç åˆ†ç¦»æˆå¤šä¸ªå‡½æ•°ï¼Œè¿™äº›å‡½æ•°æ¥æ”¶ç¨‹åºå®ä¾‹appä½œä¸ºå‚æ•°ï¼Œåˆ†åˆ«ç”¨æ¥ä¸ºç¨‹åºå®ä¾‹åˆå§‹åŒ–æ‰©å±•ã€æ³¨å†Œè“æœ¬ã€æ³¨å†Œé”™è¯¯å¤„ç†å‡½æ•°ã€æ³¨å†Œä¸Šä¸‹æ–‡å¤„ç†å‡½æ•°ç­‰ä¸€ç³»åˆ—æ“ä½œã€‚

æ„é€ å‡½æ•°`__init__.py`æ–‡ä»¶ä¸­ï¼Œå¯ä»¥è¿™æ ·ç»„ç»‡å·¥å‚å‡½æ•°ï¼š

```python
def register_logging(app):
    pass

def register_extensions(app):
    db.init_app(app)
    migrate.init_app(app, db=db)

def register_bluepirints(app):
    app.register_blueprint(auth_bp, url_prefix='/auth')
    ...

def register_shell_context(app):
    @app.shell_context_processor
    def make_shell_context():
        return dict(
            db=db, 
            migrate=migrate
        )

def register_template_context(app):
    pass

def register_errors(app):
    @app.errorhandler(400)
    def bad_request(e):
        return render_template('errors/400.html'), 400
		...

def register_commands(app):
    @app.cli.command()
    @click.option('--drop', is_flag=True, help='Create after drop.')
    def initdb(drop):
        ...
```

åœ¨create_app()å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«è°ƒç”¨è¿™äº›å‡½æ•°ï¼š

```python
def create_app(config_name=None):
    ...
    app = Flask('bluelog')
    register_logging(app)
    register_extensions(app)
    ...
    return app
```

ç°åœ¨ï¼Œå½“å·¥å‚å‡½æ•°è¢«è°ƒç”¨åï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªç‰¹å®šé…ç½®ç±»çš„ç¨‹åºå®ä¾‹ï¼Œç„¶åæ‰§è¡Œä¸€ç³»åˆ—æ³¨å†Œå‡½æ•°ä¸ºç¨‹åºå®ä¾‹æ³¨å†Œæ‰©å±•ã€è“å›¾ã€é”™è¯¯å¤„ç†å‡½æ•°ã€ä¸Šä¸‹æ–‡å¤„ç†å™¨ã€è¯·æ±‚å¤„ç†å™¨ç­‰ç­‰ï¼Œåœ¨è¿™ä¸ªç¨‹åºå·¥å‚çš„åŠ å·¥æµæ°´çº¿å°½å¤´ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªåŒ…å«æ‰€æœ‰åŸºæœ¬ç»„ä»¶çš„å¯ä»¥ç›´æ¥è¿è¡Œçš„ç¨‹åºå®ä¾‹ã€‚

##### 4. å¯åŠ¨ç¨‹åº

å½“ä½¿ç”¨flask runå‘½ä»¤å¯åŠ¨ç¨‹åºæ—¶ï¼ŒFlaskçš„è‡ªåŠ¨å‘ç°ç¨‹åºå®ä¾‹æœºåˆ¶è¿˜åŒ…å«å¦ä¸€ç§è¡Œä¸ºï¼šFlaskä¼šè‡ªåŠ¨ä»ç¯å¢ƒå˜é‡FLASK_APPçš„å€¼å®šä¹‰çš„æ¨¡å—ä¸­å¯»æ‰¾åä¸ºcreate_app()æˆ–make_app()çš„å·¥å‚å‡½æ•°ï¼Œè‡ªåŠ¨è°ƒç”¨å·¥å‚å‡½æ•°åˆ›å»ºç¨‹åºå®ä¾‹å¹¶æ‰§è¡Œã€‚

å¦‚æœä½ æƒ³è®¾ç½®ç‰¹å®šçš„é…ç½®åç§°ï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯é€šè¿‡ç¯å¢ƒå˜é‡FLASK_CONFIG_NAMEè®¾ç½®ã€‚å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨FLASK_APPæ˜¾ç¤ºåœ°æŒ‡å®šå·¥å‚å‡½æ•°å¹¶ä¼ å…¥å‚æ•°ï¼š

```shell
FLASK_APP="bluelog:create_app('development')"
```

> ä¸ºäº†æ”¯æŒFlaskè‡ªåŠ¨ä»FLASK_APPç¯å¢ƒå˜é‡å¯¹åº”å€¼æŒ‡å‘çš„æ¨¡å—æˆ–åŒ…ä¸­å‘ç°å·¥å‚å‡½æ•°ï¼Œå·¥å‚å‡½æ•°ä¸­æ¥æ”¶çš„å‚æ•°å¿…é¡»æ˜¯é»˜è®¤å‚æ•°ï¼Œå³è®¾ç½®äº†é»˜è®¤å€¼çš„å‚æ•°ï¼Œæ¯”å¦‚config_name=Noneã€‚

##### 5. current_app

ä½¿ç”¨å·¥å‚å‡½æ•°åï¼Œæˆ‘ä»¬ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼šå¯¹äºè“æœ¬å®ä¾‹æ²¡æœ‰æä¾›ï¼Œç¨‹åºå®ä¾‹ç‹¬æœ‰çš„å±æ€§å’Œæ–¹æ³•åº”è¯¥å¦‚ä½•è°ƒç”¨å‘¢ï¼Ÿ

- ä½¿ç”¨å·¥å‚å‡½æ•°åˆ›å»ºç¨‹åºå®ä¾‹åï¼Œåœ¨å…¶ä»–æ¨¡å—ä¸­å¹¶æ²¡æœ‰ä¸€ä¸ªåˆ›å»ºå¥½çš„ç¨‹åºå®ä¾‹å¯ä»¥è®©æˆ‘ä»¬å¯¼å…¥ä½¿ç”¨
- ä½¿ç”¨å·¥å‚å‡½æ•°åï¼Œç¨‹åºå®ä¾‹å¯ä»¥å†ä»»ä½•åœ°æ–¹è¢«åˆ›å»ºã€‚ä½ ä¸èƒ½å›ºå®šå¯¼å…¥æŸä¸€ä¸ªç¨‹åºå®ä¾‹ï¼Œå› ä¸ºä¸åŒç¨‹åºå®ä¾‹å¯èƒ½åŠ è½½ä¸åŒçš„é…ç½®å˜é‡

è§£å†³åŠæ³•æ˜¯**ä½¿ç”¨current_appå¯¹è±¡ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»£è¡¨å½“å‰ç¨‹åºå®ä¾‹çš„ä»£ç†å¯¹è±¡ã€‚å½“æŸä¸ªç¨‹åºå®ä¾‹è¢«åˆ›å»ºå¹¶è¿è¡Œæ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æŒ‡å‘å½“å‰è¿è¡Œçš„ç¨‹åºå®ä¾‹ï¼Œå¹¶æŠŠæ‰€æœ‰æ“ä½œéƒ½è½¬å‘åˆ°å½“å‰çš„ç¨‹åºå®ä¾‹ã€‚**æ¯”å¦‚ï¼Œå½“æˆ‘ä»¬éœ€è¦è·å–é…ç½®å€¼æ—¶ï¼Œä¼šä½¿ç”¨current_app.configï¼Œå…¶ä»–æ–¹æ³•å’Œå±æ€§äº¦åŒã€‚

> æ³¨æ„ğŸ“¢ï¼šcurrent_appæ˜¯ç¨‹åºä¸Šä¸‹æ–‡å…¨å±€å˜é‡ï¼Œæ‰€ä»¥åªæœ‰åœ¨æ¿€æ´»äº†ç¨‹åºä¸Šä¸‹æ–‡ä¹‹åæ‰èƒ½ä½¿ç”¨ã€‚æ¯”å¦‚åœ¨è§†å›¾å‡½æ•°ä¸­ï¼Œæˆ–æ˜¯åœ¨è¯•å›¾å‡½æ•°ä¸­è°ƒç”¨çš„å‡½æ•°å’Œå¯¹è±¡ä¸­ã€‚