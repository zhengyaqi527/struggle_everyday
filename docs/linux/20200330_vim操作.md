## Summary

### 模式介绍

#### 正常模式（Normal-Mode）

> 正常模式一般用于浏览文件，也包括一些复制、粘贴、删除等操作。
>
> 这时击键时，一般的键/键组合会被当成功能键，而不会键入对应的字符。
>
> 在这个模式下，我们可能通过键盘在文本中跳来跳去，跳动的范围从小到大是字符、单词、行、句子、段落和屏幕。
>
> 启动vim后默认位于正常模式。不论位于什么模式，按下<Esc>键(有时需要按两下）都会进入正常模式。



#### 插入模式 (Insert-mode)

> 在正常模式中按下i, I, a, A等键（后面系列文章会详细介绍），会进入插入模式。

- `i`  在当前光标处进行编辑
- `I` 在行首插入
- `a` 在光标后进行编辑
- `A` 在行末插入
- `o` 在当前行后插入一个新行
- `O` 在当前行前插入一个新行



#### 命令模式 (Command-mode)

> 在正常模式中，按下：（冒号）键，会进入命令模式。
>
> 在命令模式中可以执行一些输入并执行一些vim或插件提供的指令。
>
> 这些指令包括设置环境、文件操作、调用某个功能等等。



#### 可视模式 (Visual-mode)

> 在正常模式按下v, V, <Ctrl>+v，可以进入可视模式

- `v` 进入字符可视化模式
- `V` 进入行可视化模式
- `Ctrl+v` 进入块可视化模式



### 退出vim

#### 命令模式下退出：

- `:wq`  保存并退出编辑
- `:q!`  强制退出，不保存
- `:wq!`  强制保存退出
- `:w <文件路径>`  另存为
- `:saveas <文件路径>`  另存为
- `:x`  保存并退出

#### 普通模式下退出vim：

- `shift+zz` 



### 标准操作

#### x  删除字符

- `x`  删除单个字符
- `nx`  删除多个字符

#### d 删除

> d delete
>
> 被删除的内容保存在内存中，可被粘贴

- `dw` 删除单个单词

- `ndw` 删除多个单词 (或`dnw`)

- `d0` 删除光标处至行首的所有字符

- `d$` 删除光标处到行尾得所有字符

#### y 复制到内存中

> y  yank（拔除、抽出）
>
> 被复制的内容保存在内存中，可被粘贴

- `yw` 复制一个单词
- `y0` 复制光标处至行首的所有字符
- `y$` 复制光标处到行尾得所有字符

#### p 粘贴

> p  paste
>
> 用 p 来粘贴时，内容会被粘贴到光标之后。
>
> 如果用 `yy` 复制了一行，再用 p 来粘贴，那么这一行会被粘贴到光标所在行的下一行处。

- `np` 将同样的内容粘贴n次

#### r  R 替换

> r replace

- `r ` 替换一个字符

- `R` 替换多个字符

  > 切换到替换模式，左下角显示--REPLACE--

#### g G 跳转

> g go

- `G` 跳转到最后一行
- `gg` 跳转到第一行
- `nG` 或 `ngg` 跳转到指定行（n  行号）



### 高级操作

#### / 查找

> 按下 /（斜杠）键，那么就进入了查找模式
>
> 输入要查找的内容，按回车键，光标会转到下一个查找到的匹配处

- `Pattern not found` 没有查找到匹配项
- 找到匹配结果：
  - `n` 查找下一个匹配项
  - `N` 反向查找
- `/str\c` 大小写不敏感
- `/str\C` 大小写敏感

> 如果要从当前光标处开始，向文件开头搜索，那么将斜杠（/）替换为问号（?）即可，其它功能是一样的。

#### :S 查找替换

> s  substitute

```bash
# 语法
:{作用范围}s/{目标}/{替换}/{替换标志}
```

- 作用范围

  - `:s/foo/bar`  当前行查找foo，并替换为bar

  - `:%s/foo/bar` 全局查找foo，并替换为bar
  - 选区：在Visual模式下**选择区域后**输入`:`，Vim即可自动补全为 `:'<,'>`。
  - 指定行号
    - `:2,15s/foo/bar` 第2到第15行查找foo，并替换为bar
    - `:.,+2s/foo/bar` 当前行与其后面的两行内，查找foo，并替换为bar

- 替换标志

  - `空`  表示只替换从光标位置开始，目标的第一次出现

    `:s/foo/bar`

  - `g`  表示替换目标的所有出现

    `:s/foo/bar/g`

  - `i`  表示大小写不敏感查找

    `:s/foo/bar/i`

  - `I`  表示大小写敏感查找

    `:s/foo/bar/I`

  - `c`  表示替换前需要确认

    `:s/foo/bar/gc`

#### :r 合并文件

`:r <文件路径>`

#### 分屏

> Vim的分屏功能，可以同时打开好几个文件。
>
> 分屏之后，屏幕的每一块被称为一个 viewport，表示“视口”。

#### `:sp` 横向分屏

> sp split
>
> 默认是横向分割

- `:sp`  重复打开当前文件
- `:sp <文件路径>` 打开指定文件

#### `:vsp` 垂直分屏

> vsp vertically split
>
> 横向分屏和垂直分屏是可以组合的

- `:vsp`  重复打开当前文件
- `:vsp <文件路径>` 打开指定文件

  #### 分屏下的快捷键

- 切换viewport

  | 按键              | 作用                      |
  | :---------------- | :------------------------ |
  | Ctrl + w 然后按 h | 移动光标到左边的 viewport |
  | Ctrl + w 然后按 j | 移动光标到下边的 viewport |
  | Ctrl + w 然后按 k | 移动光标到上边的 viewport |
  | Ctrl + w 然后按 l | 移动光标到右边的 viewport |

<img src="https://i.loli.net/2020/03/30/3uHz6TaA1QCqbgt.png" alt="image.png" style="zoom:67%;" />

* Ctrl + w —> + ：扩大当前 viewport。

* Ctrl + w —> - ：缩小当前 viewport。

* Ctrl + w  —> = ：重新均匀分配各个 viewport 的占比。

* Ctrl + w  —> r ：调换各个 viewport 的位置。用 R 的话是反向调换。

* Ctrl + w  —> q 或 c ：关闭当前 viewport。输入 `:quit` 或 `:close` 也有一样效果

  > q   quit
  >
  > c  close

* Ctrl + w  —> o ：只保留当前所在 viewport，关闭其他 viewport。

  > 输入 `:only` 也有一样效果
  >
  > o  only



#### `:!` 运行外部命令

`:!ls` 在Vim 打开的文件所在目录运行 ls 命令，列出当前目录包含的文件

> 在 Vim 中运行 ls 命令后，终端暂时隐藏了 Vim 的界面，而显示了 ls 命令的运行结果。
>
> 底下有一句话：“Press ENTER or type command to continue”，按下回车键，就切换回Vim 的界面
>
> 这个方法很适合在不必离开 Vim 的情况下运行一些外部命令



### 配置vim

#### 选项参数

> 在 Vim 被启动后，可以运行一些指令来激活一些选项参数。
>
> 这些选项参数的配置在你退出 Vim 时会被忘记
>
> 如果希望所做的配置是永久性的，那么需要在家目录创建一个 Vim 的配置文件 .vimrc 。

#### 以命令模式激活选项参数

- 语法

  - 激活 `:set <选项名称>`
  - 取消 `:set <选项名称>`

  > 有些选项参数需要被指定一个值，像这样：
  >
  > ```
  > :set 选项名=数值
  > ```
  >
  > 如果想了解一个选项参数的状态，只需要输入：
  >
  > ```
  > :set 选项名?
  > ```



#### 在配置文件中配置选项参数

> 如果不喜欢“短暂性”的用命令来配置选项参数的方法，那么可以用一个配置文件，在里面写入所需选项参数的配置
>
> 目前在用户家目录还没有 .vimrc （注意前面有一点 `.` ，表示是隐藏文件）这个 Vim 的配置文件。但是在 /etc/vim 目录中有一个文件叫做 vimrc （注意前面没有一点 `.`）。
>
> 把 /etc/vim 目录下的 vimrc 拷贝到我们家目录中，并且重命名为 .vimrc
>
> ```bash
> cp /etc/vim/vimrc ~/.vimrc
> ```
>
> 打开文档：
>
> 以双引号（`"`）开头的行是注释
>
> 可以看到一些选项参数的配置行前面有双引号，表示这个选项参数还没有被激活，可以删除行首的双引号来激活这个选项参数。
>
> * 选项参数已存在、已激活（前面没有 `"`（双引号））。
> * 选项参数已经存在、没有被激活（前面有 `"`（双引号）），可以去掉前面的双引号来激活它。
> * 选项参数还没存在，直接添加即可。



#### 常见选项参数

- syntax  语法高亮

  ```bash
  syntax on
  ```

- background   背景着色

  ```bash
  set background=dark
  ```

- number  显示行号

  ```bash
  set number
  ```

- showcmd   显示当前命令

  ```bash
  set showcmd
  ```

- ignorecase   查找是忽略大小写

  ```bash
  set ignorecase
  ```

- mouse  鼠标支持

  ```bash
  set mouse=a
  ```

  > 激活鼠标之后，可以用鼠标来点击文件中任意位置，使光标移动到那里
  >
  > 可以用鼠标来选择一段文本，自动会切换到 VISUAL 模式，也就是“可视”模式
  >
  > 在这个模式下，可以用 x 来删除刚才选中的文本，用大写的 U 来把文本转为大写，u 来把文本转为小写等等。